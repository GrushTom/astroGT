import{_ as C}from"./preload-helper.BlTxHScW.js";import{p as S,u as A}from"./url-utils.BDbY8fRT.js";import{k as E,l as v,m as L,B as k,n as g,o as M}from"./setting-utils.BtIsBdch.js";import{s as x}from"./sponsorConfig.B0M2-v-R.js";import"./zh_TW.BgGbRV6C.js";function w(){function o(e){if(e.hasAttribute("data-icon-initialized"))return;e.setAttribute("data-icon-initialized","true");const i=e.querySelector("[data-loading-indicator]"),t=e.querySelector("[data-icon-element]"),n=t?.getAttribute("icon");if(!i||!t)return;function s(){return t.shadowRoot&&t.shadowRoot.children.length>0?(a(),!0):!1}function a(){i.style.display="none",t.classList.remove("opacity-0"),t.classList.add("opacity-100")}function r(){i.style.display="inline-flex",t.classList.remove("opacity-100"),t.classList.add("opacity-0")}if(r(),t.addEventListener("load",()=>{a()}),t.addEventListener("error",()=>{n&&console.warn(`Failed to load icon: ${n}`)}),window.MutationObserver){const l=new MutationObserver(()=>{s()&&l.disconnect()});l.observe(t,{childList:!0,subtree:!0,attributes:!0}),setTimeout(()=>{l.disconnect(),s()},5e3)}setTimeout(()=>{s()},100)}document.querySelectorAll("[data-icon-container]").forEach(o),window.MutationObserver&&new MutationObserver(i=>{i.forEach(t=>{t.addedNodes.forEach(n=>{if(n.nodeType===Node.ELEMENT_NODE){const s=n;s.hasAttribute?.("data-icon-container")?o(s):s.querySelectorAll("[data-icon-container]").forEach(o)}})})}).observe(document.body,{childList:!0,subtree:!0})}const _=Object.freeze(Object.defineProperty({__proto__:null,initIconLoader:w},Symbol.toStringTag,{value:"Module"})),y=!!document.getElementById("banner-wrapper");function c(o,e){document.addEventListener("click",i=>{let t=document.getElementById(o);if(!t)return;let n=i.target;if(n instanceof Node){for(let s of e){let a=document.getElementById(s);if(a==n||a?.contains(n))return}t.classList.add("float-panel-closed")}})}c("display-setting",["display-setting","display-settings-switch"]);c("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]);c("search-panel",["search-panel","search-bar","search-switch"]);c("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]);c("theme-mode-panel",["theme-mode-panel","scheme-switch"]);function b(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(e=>{if(!e.parentNode)return;const i=document.createElement("div");i.className="katex-display-container",e.parentNode.insertBefore(i,e),i.appendChild(e),i.style.cssText=`
			overflow-x: auto;
		`,e.setAttribute("data-scrollbar-initialized","true")})}function T(){requestAnimationFrame(()=>{const o=document.getElementById("banner");o&&o.classList.remove("opacity-0","scale-105");const e=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');e&&(e.classList.remove("opacity-0","scale-105"),e.classList.add("opacity-100"))})}const I=()=>{window.swup.hooks.on("link:click",()=>{if(document.documentElement.style.setProperty("--content-delay","0ms"),document.documentElement.classList.add("is-page-transitioning"),y){const o=document.getElementById("navbar-wrapper");if(o&&document.body.classList.contains("lg:is-home")){const e=window.innerHeight*(g/100)-88;document.documentElement.scrollTop>=e&&o.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{const o=document.getElementById("grid-class-carrier");if(o){const n=o.getAttribute("data-grid-class"),s=document.getElementById("main-grid");if(s&&n){const r=s.className.split(" ").filter(d=>!d.startsWith("lg:grid-cols-")&&!d.startsWith("md:grid-cols-")&&!d.startsWith("grid-cols-")),l=n.split(" ");s.className=[...r,...l].join(" ")}}if(b(),C(async()=>{const{initIconLoader:n}=await Promise.resolve().then(()=>_);return{initIconLoader:n}},void 0).then(({initIconLoader:n})=>{n()}),document.getElementById("toc-wrapper")!==null){const n=document.querySelector("table-of-contents");n&&typeof n.init=="function"&&setTimeout(()=>{n.init()},100)}const t=document.getElementById("navbar");t&&t.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection()}),window.swup.hooks.on("visit:start",o=>{const e=document.querySelector("body"),i=S(o.to.url,A("/"));i?e.classList.add("lg:is-home"):e.classList.remove("lg:is-home");const t=document.querySelector(".banner-text-overlay");t&&(i?t.classList.remove("hidden"):t.classList.add("hidden"));const n=document.getElementById("navbar");n&&(n.setAttribute("data-is-home",i.toString()),n.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection());const s=window.innerWidth<1024;if(s){const m=document.getElementById("post-list-container");m&&(m.style.transition="none")}const a=document.getElementById("banner-wrapper"),r=document.querySelector(".absolute.w-full.z-30");s&&a&&r?i?(r.style.transition="none",a.style.display="",setTimeout(()=>{a.classList.remove("mobile-hide-banner")},100),setTimeout(()=>{r.classList.remove("mobile-main-no-banner"),setTimeout(()=>{r.style.transition=""},50)},150)):(a.classList.add("mobile-hide-banner"),setTimeout(()=>{r.classList.add("mobile-main-no-banner")},100)):!s&&a&&(a.style.display="",a.classList.remove("mobile-hide-banner"),r&&r.classList.remove("mobile-main-no-banner"));const l=document.getElementById("page-height-extend");l&&l.classList.remove("hidden");let d=document.getElementById("toc-wrapper");d&&d.classList.add("toc-not-ready")}),window.swup.hooks.on("page:view",()=>{const o=document.getElementById("page-height-extend");o&&o.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),window.innerWidth<1024&&setTimeout(()=>{const a=document.getElementById("post-list-container");a&&(a.style.transition="")},600);const i=localStorage.getItem("theme")||x.themeColor.defaultMode||"light";let t=!1;i==="system"?t=window.matchMedia("(prefers-color-scheme: dark)").matches:t=i==="dark";const n=t?L.darkTheme:L.lightTheme;document.documentElement.getAttribute("data-theme")!==n&&document.documentElement.setAttribute("data-theme",n),setTimeout(()=>{if(document.getElementById("tcomment")){const a=new CustomEvent("firefly:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(a),console.log("Layout: 触发 firefly:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",o=>{setTimeout(()=>{const e=document.getElementById("page-height-extend");e&&e.classList.add("hidden");const i=document.getElementById("toc-wrapper");i&&i.classList.remove("toc-not-ready"),document.documentElement.classList.remove("is-page-transitioning")},200)})};window?.swup?.hooks?I():document.addEventListener("swup:enable",I);let u=document.getElementById("back-to-top-btn"),f=document.getElementById("toc-wrapper"),h=document.getElementById("navbar-wrapper");function N(){const o=document.documentElement.scrollTop,e=window.innerHeight*(g/100),i=[];u&&i.push(()=>{o>e?u.classList.remove("hide"):u.classList.add("hide")}),y&&f&&i.push(()=>{o>e?f.classList.remove("toc-hide"):f.classList.add("toc-hide")}),y&&h&&i.push(()=>{const n=document.body.classList.contains("lg:is-home")&&window.innerWidth>=1024?M:g,s=window.innerHeight*(n/100)-88;o>=s?h.classList.add("navbar-hidden"):h.classList.remove("navbar-hidden")}),i.length>0&&requestAnimationFrame(()=>{i.forEach(t=>t())})}let p;window.addEventListener("scroll",()=>{p&&cancelAnimationFrame(p),p=requestAnimationFrame(N)},{passive:!0});window.onresize=()=>{let o=Math.floor(window.innerHeight*(k/100));o=o-o%4,document.documentElement.style.setProperty("--banner-height-extend",`${o}px`)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{T(),b()}):(T(),b());document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{E(),v(),w(),B()}):(E(),v(),w(),B());function B(){const o=document.title;let e=null;function i(){e&&(clearTimeout(e),e=null),document.title=o}function t(l,d=2e3){e&&(clearTimeout(e),e=null),document.title=l,e=window.setTimeout(i,d)}function n(l){e&&(clearTimeout(e),e=null),document.title=l}function s(){document.hidden?n("(っ °Д °;)っ主人看看机体喵！"):t("ヾ(≧▽≦*)o机体最喜欢主人啦！")}function a(){t("ヾ(≧▽≦*)o机体最喜欢主人啦！")}function r(){n("(っ °Д °;)っ主人看看机体喵！")}document.addEventListener("visibilitychange",s),window.addEventListener("focus",a),window.addEventListener("blur",r)}
